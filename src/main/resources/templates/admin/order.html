<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="'–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ #' + ${orderDto.id}">–ó–∞–∫–∞–∑ #0</title>

    <link rel="stylesheet" href="../../static/css/common/footer.css" th:href="@{/css/common/footer.css}">
    <link rel="stylesheet" href="../../static/css/common/header.css" th:href="@{/css/common/header.css}">
    <link rel="stylesheet" href="../../static/css/admin/order.css" th:href="@{/css/admin/order.css}">

    <script th:src="@{/js/common/header.js}"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        /* –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º—ã */
        .edit-form-wrapper {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .details-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        /* –ö–ê–†–¢–û–ß–ö–ò */
        .main-info-card, .actions-card {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .main-info-card { flex: 2; }
        .actions-card {
            flex: 1;
            position: sticky;
            top: 20px;
        }

        /* –ó–ê–ì–û–õ–û–í–û–ö */
        .details-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .details-header h2 { margin: 0; color: #fff; }

        /* –ü–û–õ–Ø –í–í–û–î–ê (INPUTS & TEXTAREA) */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: var(--text-muted);
            font-size: 13px;
            margin-bottom: 8px;
        }

        .edit-input, .edit-textarea {
            width: 100%;
            background: var(--input-bg); /* #4d6b54 –∏–∑ —Ç–≤–æ–µ–≥–æ CSS */
            border: 1px solid transparent;
            border-radius: 12px;
            padding: 12px 16px;
            color: #fff;
            font-family: inherit;
            font-size: 15px;
            box-sizing: border-box; /* –í–∞–∂–Ω–æ –¥–ª—è padding */
            transition: border-color 0.2s;
        }

        .edit-input:focus, .edit-textarea:focus {
            outline: none;
            border-color: #fff;
        }

        .edit-textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.5;
        }

        /* –¢–ê–ë–õ–ò–¶–ê –¢–û–í–ê–†–û–í (Read Only) */
        .items-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        .items-table th, .items-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .items-table th { color: var(--text-muted); font-size: 13px; background: rgba(0,0,0,0.3); }
        .items-table tr:last-child td { border-bottom: none; }

        /* –ö–ù–û–ü–ö–ò –°–¢–ê–¢–£–°–û–í */
        .status-actions-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            color: white;
            text-transform: uppercase;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .action-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .action-btn:active { transform: translateY(0); }

        /* –¶–≤–µ—Ç–∞ –∫–Ω–æ–ø–æ–∫ */
        .btn-save-only { background: #555; border: 1px solid #777; margin-bottom: 10px; }
        .btn-status-created { background: #3498db; }
        .btn-status-paid { background: #f1c40f; color: #333; }
        .btn-status-shipped { background: #9b59b6; }
        .btn-status-delivered { background: #2ecc71; }
        .btn-status-cancelled { background: #e74c3c; }

        /* –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (–∞–∫—Ç–∏–≤–Ω—ã–π) */
        .current-status-badge {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .current-status-badge .label { font-size: 12px; color: var(--text-muted); }
        .current-status-badge .value { font-size: 18px; font-weight: bold; margin-top: 5px; color: #fff; }

        @media (max-width: 900px) {
            .details-container { flex-direction: column; }
            .actions-card { width: 100%; position: relative; top: 0; box-sizing: border-box; }
            .main-info-card { width: 100%; box-sizing: border-box; }
        }
    </style>
</head>
<body>

<header class="main-header">
    <div class="logo">Stroy1Click</div>

    <nav>
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
        <a href="/about-us">–û –Ω–∞—Å</a>
        <a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
    </nav>

    <div class="header">
        <div class="search-icon-wrapper">
            <svg viewBox="0 0 24 24">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 3 13.09 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
        </div>

        <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...">
    </div>

    <div class="header-actions">
        <a href="/cart" class="action-btn cart-btn">
            <svg viewBox="0 0 24 24">
                <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
            <span class="btn-text">–ö–æ—Ä–∑–∏–Ω–∞</span>
        </a>

        <a href="/user/profile" class="action-btn profile-btn">
            <svg viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            <span class="btn-text">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
    </div>

    <div class="burger" onclick="toggleMenu()">
        <span></span><span></span><span></span>
    </div>

    <div id="mobile-menu" class="mobile-menu">
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
        <a href="/about-us">–û –Ω–∞—Å</a>
        <a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
    </div>
</header>

<div class="container">

    <form class="edit-form-wrapper" th:action="@{/admin/orders/{id}/update(id=${orderDto.id})}" th:object="${orderDto}" method="post">

        <input type="hidden" th:field="*{id}">
        <input type="hidden" th:field="*{userId}">
        <input type="hidden" th:field="*{createdAt}">
        <input type="hidden" th:field="*{updatedAt}">


        <div th:each="item, stat : *{orderItems}">
            <input type="hidden" th:field="*{orderItems[__${stat.index}__].productId}">
            <input type="hidden" th:field="*{orderItems[__${stat.index}__].quantity}">
        </div>

        <div class="details-container">

            <div class="main-info-card">
                <div class="details-header">
                    <h2 th:text="'–ó–∞–∫–∞–∑ #' + *{id}">–ó–∞–∫–∞–∑</h2>
                    <span style="color: var(--text-muted); font-size: 14px;" th:text="'User ID: ' + *{userId}"></span>
                </div>

                <div class="form-group">
                    <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω</label>
                    <div class="input-group">
                        <input type="text" class="edit-input" th:field="*{contactPhone}">
                        <svg style="position:absolute; right:14px; top:50%; transform:translateY(-50%); width:20px; fill:#b5b5b5;" viewBox="0 0 24 24">
                            <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                        </svg>
                    </div>
                    <p style="color: #ff4d4d; font-size: 12px; margin-top: 5px;" th:if="${#fields.hasErrors('contactPhone')}" th:errors="*{contactPhone}"></p>
                </div>

                <div class="form-group">
                    <label class="form-label">–ó–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                    <textarea class="edit-textarea" th:field="*{notes}"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">–ò–ù–ù</label>
                    <textarea class="edit-textarea" th:field="*{inn}"></textarea>
                    <p style="color: #ff4d4d; font-size: 12px; margin-top: 5px;" th:if="${#fields.hasErrors('inn')}" th:errors="*{contactPhone}"></p>
                </div>

                <div class="form-group">
                    <label class="form-label">–ö–ü–ü</label>
                    <textarea class="edit-textarea" th:field="*{kpp}"></textarea>
                    <p style="color: #ff4d4d; font-size: 12px; margin-top: 5px;" th:if="${#fields.hasErrors('kpp')}" th:errors="*{contactPhone}"></p>
                </div>

                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –ö–æ–º–ø–∞–Ω–∏–∏</label>
                    <textarea class="edit-textarea" th:field="*{legalName}"></textarea>
                    <p style="color: #ff4d4d; font-size: 12px; margin-top: 5px;" th:if="${#fields.hasErrors('legalName')}" th:errors="*{contactPhone}"></p>
                </div>

                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏</label>
                    <textarea class="edit-textarea" th:field="*{legalForm}"></textarea>
                    <p style="color: #ff4d4d; font-size: 12px; margin-top: 5px;" th:if="${#fields.hasErrors('legalForm')}" th:errors="*{contactPhone}"></p>
                </div>

                <div class="form-group">
                    <label class="form-label">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                    <textarea class="edit-textarea" th:field="*{deliveryAddress}"></textarea>
                    <p style="color: #ff4d4d; font-size: 12px; margin-top: 5px;" th:if="${#fields.hasErrors('deliveryAddress')}" th:errors="*{contactPhone}"></p>
                </div>

                <div class="form-group">
                    <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π email</label>
                    <textarea class="edit-textarea" th:field="*{contactEmail}"></textarea>
                    <p style="color: #ff4d4d; font-size: 12px; margin-top: 5px;" th:if="${#fields.hasErrors('contactEmail')}" th:errors="*{contactPhone}"></p>
                </div>

                <div style="display: flex; gap: 30px; margin-bottom: 25px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <div>
                        <span class="form-label">–°–æ–∑–¥–∞–Ω</span>
                        <span th:text="${#temporals.format(orderDto.createdAt, 'dd.MM.yyyy HH:mm')}"></span>
                    </div>
                    <div>
                        <span class="form-label">–û–±–Ω–æ–≤–ª–µ–Ω</span>
                        <span th:text="${#temporals.format(orderDto.updatedAt, 'dd.MM.yyyy HH:mm')}"></span>
                    </div>
                </div>

                <h3 style="margin-bottom: 15px; font-size: 18px;">–¢–æ–≤–∞—Ä—ã</h3>
                <table class="items-table">
                    <thead>
                    <tr>
                        <th>ID —Ç–æ–≤–∞—Ä–∞</th>
                        <th style="text-align: right;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="item : *{orderItems}">
                        <td>
                            <a th:href="@{/admin/products/{id}(id=${item.productId})}" style="color: #fff;" th:text="'# ' + ${item.productId}"></a>
                        </td>
                        <td style="text-align: right; font-weight: bold;" th:text="${item.quantity} + ' —à—Ç.'"></td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="actions-card">
                <div class="current-status-badge">
                    <div class="label">–°—Ç–∞—Ç—É—Å —Å–µ–π—á–∞—Å</div>
                    <div class="value" th:text="*{orderStatus}"></div>
                </div>

                <div class="status-actions-list">
                    <button type="submit" name="orderStatus" th:value="*{orderStatus}" class="action-btn btn-save-only">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>

                    <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 5px 0;"></div>

                    <button type="submit" name="orderStatus" value="PAID" class="action-btn btn-status-paid"
                            th:if="${orderDto.orderStatus.name() != 'PAID'}">–û–ø–ª–∞—á–µ–Ω</button>

                    <button type="submit" name="orderStatus" value="SHIPPED" class="action-btn btn-status-shipped"
                            th:if="${orderDto.orderStatus.name() != 'SHIPPED'}">–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</button>

                    <button type="submit" name="orderStatus" value="DELIVERED" class="action-btn btn-status-delivered"
                            th:if="${orderDto.orderStatus.name() != 'DELIVERED'}">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</button>

                    <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 5px 0;"></div>

                    <button type="submit" name="orderStatus" value="CANCELLED" class="action-btn btn-status-cancelled"
                            th:if="${orderDto.orderStatus.name() != 'CANCELLED'}">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                </div>
            </div>

        </div>
    </form>
</div>

<footer>
    <div class="col">
        <h3>Stroy1Click</h3>
        <p>–û–û–û "–í—ç–ª–°–Ω–∞–±"</p>
        <p>–ù–∞–¥—ë–∂–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</p>
        <p>+7 914 790 43 80</p>
        <p>2704380@mail.ru</p>
        <p>–≥. –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, —É–ª. –í—ã—Å–µ–ª–∫–æ–≤–∞—è 61–≤.</p>
    </div>
</footer>

</body>
</html>