<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–æ—Ä–∑–∏–Ω–∞</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../static/css/common/footer.css" th:href="@{/css/common/footer.css}">
    <link rel="stylesheet" href="../../static/css/common/header.css" th:href="@{/css/common/header.css}">
    <script src="../../static/js/common/header.js" th:src="@{/js/common/header.js}"></script>
    <style>
        body { font-family: Inter, sans-serif; background: #3f4f3c; color: #fff; margin: 0; }
        .container { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
        h1 { margin-bottom: 30px; }

        /* –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤  */
        .cart-list { background: #2f3e2d; border-radius: 12px; padding: 20px; margin-bottom: 30px; }
        .cart-item { display: flex; align-items: center; gap: 20px; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .cart-item:last-child { border-bottom: none; }
        .cart-img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; background: #444; }
        .cart-info { flex: 1; }
        .cart-title { font-weight: bold; font-size: 16px; margin-bottom: 5px; }
        .cart-price { color: #d9f2c4; font-weight: bold; }

        .cart-controls { display: flex; align-items: center; gap: 10px; }
        .qty-input { width: 50px; padding: 5px; border-radius: 5px; border: none; text-align: center; }
        .remove-btn { background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }

        /* –§–æ—Ä–º–∞ –∑–∞–∫–∞–∑–∞ */
        .order-form { background: #2f3e2d; border-radius: 12px; padding: 30px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #d8d8d8; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; border-radius: 8px; border: none; font-size: 16px; }
        .total-price { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #d9f2c4; text-align: right; }

        .checkout-btn { width: 100%; background: #6a8573; color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .checkout-btn:hover { background: #5d6d54; }
    </style>
</head>
<body>

<header class="main-header">
    <div class="logo">Stroy1Click</div>

    <nav>
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
        <a href="/about-us">–û –Ω–∞—Å</a>
        <a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
    </nav>

    <div class="header">
        <div class="search-icon-wrapper">
            <svg viewBox="0 0 24 24">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 3 13.09 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
        </div>

        <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...">
    </div>

    <div class="header-actions">
        <div class="action-btn cart-btn">
            <svg viewBox="0 0 24 24">
                <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
            <a href="/cart" class="btn-text">–ö–æ—Ä–∑–∏–Ω–∞</a>
        </div>

        <div class="action-btn profile-btn">
            <svg viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            <a href="/user/profile" class="btn-text">–ü—Ä–æ—Ñ–∏–ª—å</a>
        </div>
    </div>

    <div class="burger" onclick="toggleMenu()">
        <span></span><span></span><span></span>
    </div>

    <div id="mobile-menu" class="mobile-menu">
        <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
        <a href="/about-us">–û –Ω–∞—Å</a>
        <a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
    </div>
</header>

<div class="container">
    <h1>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>

    <div id="cartItemsContainer" class="cart-list">
        <p style="text-align:center">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
    </div>

    <div class="order-form" id="orderFormBlock" style="display:none;">
        <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
        <div class="total-price">–ò—Ç–æ–≥–æ: <span id="cartTotal">0</span> ‚ÇΩ</div>

        <!-- üîπ –î–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ -->
        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="font-size: 16px; margin-top: 0; color: #d9f2c4;">–î–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</h3>

            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                <div style="flex: 1;">
                    <label style="font-size: 12px;">–§–æ—Ä–º–∞</label>
                    <select id="legalFormInput">
                        <option value="LLC">–û–û–û</option>
                        <option value="IE">–ò–ü</option>
                    </select>
                </div>

                <div style="flex: 3;">
                    <label style="font-size: 12px;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</label>
                    <input type="text" id="legalNameInput" placeholder="–û–û–û –°—Ç—Ä–æ–π–°–Ω–∞–±">
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label style="font-size: 12px;">–ò–ù–ù</label>
                    <input type="text" id="innInput" placeholder="10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä">
                </div>

                <div style="flex: 1;">
                    <label style="font-size: 12px;">–ö–ü–ü (–¥–ª—è –û–û–û)</label>
                    <input type="text" id="kppInput" placeholder="9 —Ü–∏—Ñ—Ä">
                </div>
            </div>
        </div>

        <!-- üîπ –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
        <div class="form-group">
            <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
            <input type="text" id="contactNameInput" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
        </div>

        <div class="form-group">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω (+7...)</label>
            <input type="text" id="phoneInput" placeholder="+79990000000" value="+7">
        </div>

        <div class="form-group">
            <label>Email</label>
            <input type="email" id="emailInput" placeholder="example@mail.ru">
        </div>

        <div class="form-group">
            <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
            <input type="text" id="addressInput" placeholder="–≥. –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, —É–ª...">
        </div>

        <div class="form-group">
            <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
            <textarea id="notesInput" rows="3" placeholder="–ü–æ–¥—ä–µ–∑–¥, –∫–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞..."></textarea>
        </div>

        <input type="hidden" id="userIdInput" value="1">

        <button class="checkout-btn" onclick="submitOrder()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
</div>

<script src="../../static/js/cart/cart.js" th:src="@{/js/cart/cart.js}"></script>
<script>
    // –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω—ã
    function renderCartPage() {
        const cart = CartService.getCart();
        const container = document.getElementById('cartItemsContainer');
        const formBlock = document.getElementById('orderFormBlock');
        const totalEl = document.getElementById('cartTotal');

        if (cart.length === 0) {
            container.innerHTML = '<p style="text-align:center; padding: 20px;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. <a href="/" style="color:#8aff8a">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</a></p>';
            formBlock.style.display = 'none';
            return;
        }

        formBlock.style.display = 'block';
        let total = 0;

        container.innerHTML = cart.map(item => {
            const itemSum = item.price * item.quantity;
            total += itemSum;
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
            const img = item.image && item.image.includes('/') ? item.image : '/static/images/placeholder.png';

            return `
                <div class="cart-item">
                    <img src="${img}" class="cart-img" alt="">
                    <div class="cart-info">
                        <div class="cart-title">${item.title}</div>
                        <div class="cart-price">${item.price.toLocaleString()} ‚ÇΩ</div>
                    </div>
                    <div class="cart-controls">
                        <input type="number" class="qty-input" value="${item.quantity}" min="1"
                               onchange="CartService.updateQuantity(${item.id}, this.value)">
                        <button class="remove-btn" onclick="CartService.removeFromCart(${item.id})">√ó</button>
                    </div>
                </div>
            `;
        }).join('');

        totalEl.innerText = total.toLocaleString();
    }

    function submitOrder() {

        const orderData = {
            userId: document.getElementById('userIdInput').value,
            legalForm: document.getElementById('legalFormInput').value,
            legalName: document.getElementById('legalNameInput').value,
            inn: document.getElementById('innInput').value,
            kpp: document.getElementById('kppInput').value,
            contactName: document.getElementById('contactNameInput').value,
            contactPhone: document.getElementById('phoneInput').value,
            contactEmail: document.getElementById('emailInput').value,
            deliveryAddress: document.getElementById('addressInput').value,
            notes: document.getElementById('notesInput').value
        };

        // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        const phoneRegex = /^(\+7|8)\d{10}$/;
        if (!phoneRegex.test(orderData.contactPhone)) {
            alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞: +79991234567');
            return;
        }

        CartService.checkout(orderData);
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    renderCartPage();
</script>

</body>
<footer>
    <div class="col">
        <h3>Stroy1Click</h3>
        <p>–û–û–û "–í—ç–ª–°–Ω–∞–±"</p>
        <p>–ù–∞–¥—ë–∂–Ω—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</p>
        <p>+7 914 790 43 80</p>
        <p>2704380@mail.ru</p>
        <p>–≥. –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, —É–ª. –í—ã—Å–µ–ª–∫–æ–≤–∞—è 61–≤.</p>
    </div>
</footer>
</html>