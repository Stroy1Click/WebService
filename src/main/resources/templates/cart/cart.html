<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Корзина</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../static/css/common/footer.css" th:href="@{/css/common/footer.css}">
    <link rel="stylesheet" href="../../static/css/common/header.css" th:href="@{/css/common/header.css}">
    <script src="../../static/js/common/header.js" th:src="@{/js/common/header.js}"></script>
    <style>
        body { font-family: Inter, sans-serif; background: #3f4f3c; color: #fff; margin: 0; }
        .container { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
        h1 { margin-bottom: 30px; }

        /* Список товаров */
        .cart-list { background: #2f3e2d; border-radius: 12px; padding: 20px; margin-bottom: 30px; }
        .cart-item { display: flex; align-items: center; gap: 20px; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .cart-item:last-child { border-bottom: none; }
        .cart-img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; background: #444; }
        .cart-info { flex: 1; }
        .cart-title { font-weight: bold; font-size: 16px; margin-bottom: 5px; }
        .cart-price { color: #d9f2c4; font-weight: bold; }

        .cart-controls { display: flex; align-items: center; gap: 10px; }
        .qty-input { width: 50px; padding: 5px; border-radius: 5px; border: none; text-align: center; }
        .remove-btn { background: #ff6b6b; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }

        /* Форма заказа */
        .order-form { background: #2f3e2d; border-radius: 12px; padding: 30px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: #d8d8d8; }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; border-radius: 8px; border: none; font-size: 16px; }
        .total-price { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #d9f2c4; text-align: right; }

        .checkout-btn { width: 100%; background: #6a8573; color: white; padding: 15px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .checkout-btn:hover { background: #5d6d54; }
    </style>
</head>
<body>

<header class="main-header">
    <div class="logo">Stroy1Click</div>

    <nav>
        <a href="#">Главная</a>
        <a href="#">Категории</a>
        <a href="#">О нас</a>
        <a href="#">Контакты</a>
    </nav>

    <div class="header">
        <div class="search-icon-wrapper">
            <svg viewBox="0 0 24 24">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 3 13.09 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
            </svg>
        </div>

        <input type="text" class="search-input" placeholder="Поиск товаров...">
    </div>

    <div class="header-actions">
        <div class="action-btn cart-btn">
            <svg viewBox="0 0 24 24">
                <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
            <span class="btn-text">Корзина</span>
        </div>

        <div class="action-btn profile-btn">
            <svg viewBox="0 0 24 24">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            <span class="btn-text">Профиль</span>
        </div>
    </div>

    <div class="burger" onclick="toggleMenu()">
        <span></span><span></span><span></span>
    </div>

    <div id="mobile-menu" class="mobile-menu">
        <a href="#">Главная</a>
        <a href="#">Категории</a>
        <a href="#">О нас</a>
        <a href="#">Контакты</a>
    </div>
</header>

<div class="container">
    <h1>Ваша корзина</h1>

    <div id="cartItemsContainer" class="cart-list">
        <p style="text-align:center">Корзина пуста</p>
    </div>

    <div class="order-form" id="orderFormBlock" style="display:none;">
        <h2>Оформление заказа</h2>
        <div class="total-price">Итого: <span id="cartTotal">0</span> ₽</div>

        <div class="form-group">
            <label>Ваш телефон (+7...)</label>
            <input type="text" id="phoneInput" placeholder="+79990000000" value="+7">
        </div>

        <div class="form-group">
            <label>Комментарий к заказу</label>
            <textarea id="notesInput" rows="3" placeholder="Подъезд, код домофона..."></textarea>
        </div>

        <input type="hidden" id="userIdInput" value="1">

        <button class="checkout-btn" onclick="submitOrder()">Оформить заказ</button>
    </div>
</div>

<script src="../../static/js/cart/cart.js" th:src="@{/js/cart/cart.js}"></script>
<script>
    // Логика отображения корзины
    function renderCartPage() {
        const cart = CartService.getCart();
        const container = document.getElementById('cartItemsContainer');
        const formBlock = document.getElementById('orderFormBlock');
        const totalEl = document.getElementById('cartTotal');

        if (cart.length === 0) {
            container.innerHTML = '<p style="text-align:center; padding: 20px;">Корзина пуста. <a href="/" style="color:#8aff8a">Перейти в каталог</a></p>';
            formBlock.style.display = 'none';
            return;
        }

        formBlock.style.display = 'block';
        let total = 0;

        container.innerHTML = cart.map(item => {
            const itemSum = item.price * item.quantity;
            total += itemSum;
            // Проверка на наличие картинки
            const img = item.image && item.image.includes('/') ? item.image : '/static/images/placeholder.png';

            return `
                <div class="cart-item">
                    <img src="${img}" class="cart-img" alt="">
                    <div class="cart-info">
                        <div class="cart-title">${item.title}</div>
                        <div class="cart-price">${item.price.toLocaleString()} ₽</div>
                    </div>
                    <div class="cart-controls">
                        <input type="number" class="qty-input" value="${item.quantity}" min="1"
                               onchange="CartService.updateQuantity(${item.id}, this.value)">
                        <button class="remove-btn" onclick="CartService.removeFromCart(${item.id})">×</button>
                    </div>
                </div>
            `;
        }).join('');

        totalEl.innerText = total.toLocaleString();
    }

    function submitOrder() {
        const phone = document.getElementById('phoneInput').value;
        const notes = document.getElementById('notesInput').value;
        // В реальном проекте ID юзера берется из токена/куки
        // Пока хардкод или поле ввода, если нужно тестировать
        const userId = 1;

        // Валидация телефона (простая)
        const phoneRegex = /^(\+7|8)\d{10}$/;
        if (!phoneRegex.test(phone)) {
            alert('Введите корректный номер телефона: +79991234567');
            return;
        }

        CartService.checkout(phone, notes, userId);
    }

    // Запуск при загрузке
    renderCartPage();
</script>

</body>
<footer>
    <div class="col">
        <h3>Stroy1Click</h3>
        <p>Надёжный поставщик строительных материалов с 2019 года.</p>
        <p>+7 999 999 99 99</p>
        <p>forexample@mail.ru</p>
        <p>город, улица, дом</p>
    </div>

    <div class="col">
        <h3>Категории</h3>
        <a href="#">Кирпич и блоки</a>
        <a href="#">Цемент и смеси</a>
        <a href="#">Инструменты</a>
        <a href="#">Сантехника</a>
        <a href="#">Электрика</a>
        <a href="#">Кровля</a>
    </div>

    <div class="col">
        <h3>Клиентам</h3>
        <a href="#">Гарантии</a>
        <a href="#">Контакты</a>
        <a href="#">О компании</a>
    </div>

    <div class="col">
        <h3>Подкатегории</h3>
        <a href="#">Кирпич и блоки</a>
        <a href="#">Цемент и смеси</a>
        <a href="#">Инструменты</a>
        <a href="#">Сантехника</a>
        <a href="#">Электрика</a>
        <a href="#">Кровля</a>
    </div>
</footer>
</html>